<div class="container mt-5 show-container">

  <% if @trip.photo.attached? %>
    <div class="trip-banner mb-5" style="background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('<%= cl_image_path @trip.photo.key, crop: :fill %>');">
  <% else %>
    <div class="trip-banner mb-5" style="background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('https://upload.wikimedia.org/wikipedia/commons/thumb/a/ac/No_image_available.svg/1024px-No_image_available.svg.png');">
  <% end %>
    <h1><%=@trip.title%></h1>
    <p><%= @trip.destination %></p>
    <% if @trip.full? || @trip.departed? %>
    <div class='text-center mt-5'>
      <p> Trip is full or has already departed!</p>
    </div>
    <% else %>
      <% if user_signed_in? %>
        <% if @trip.user == current_user %>
          <%= link_to 'Manage my trip', dashboard_path, class: 'btn-travel-primary' %>
        <% elsif current_user.accepted_in?(@trip.id) %>
          <div class='text-center mt-5'>
            <p> You already joined this trip!</p>
          </div>
        <% elsif current_user.applied_for?(@trip.id) %>
          <div class="text-center mt-5">
            <p> You already applied to this trip!</p>
          </div>
        <% else %>
          <div class='text-center mt-3'>
            <button type="button" class="btn btn-travel-primary" data-toggle="modal" data-target="#joinModal">Join this trip</button>
          </div>
        <% end %>
      <% end %>
    <% end %>
  </div>

<!-- DESCRIPTION -->
  <h2 class="text-center font-weight-bold mb-5">about the trip</h2>
  <div class="trip-description">
    <p><%= @trip.description %></p>
  </div>

<!-- SPECS -->
  <div class="spec mt-5">
    <h2 class="text-center font-weight-bold mb-5" style="font-weight:600;">specs</h2>
    <div class="trip-description">
      <div class="icons my-3" style= "display:flex;justify-content: space-around">
        <div class= "icon text-center">
          <div style="font-size: 30px;">ğŸ’µ</div>
          <p class="font-weight-bold text-center">Estimated</p>
          <p class="text-center">$<%= @trip.budget_min %> and $<%= @trip.budget_max %></p>
          </div>
        <div class= "icon text-center">
          <div style="font-size: 30px;">ğŸ›«</div>
          <p class="font-weight-bold text-center">Departure date</p>
          <p class= "text-center"><%= @trip.departure_date.strftime('%e %B %Y') %></p>
        </div>
        <div class= "icon text-center">
          <div style="font-size: 30px;">ğŸ›¬</div>
          <p class="font-weight-bold text-center">Return date</p>
          <p class= 'text-center'><%= @trip.return_date.strftime('%e %B %Y') %></p>
        </div>
        <div class= "icon text-center">
          <div style="font-size: 30px;">ğŸ‘©â€ğŸ‘©â€ğŸ‘§â€ğŸ‘§</div>
          <p class="font-weight-bold text-center">Capacity max</p>
          <p class="text-center"><%= @trip.max_capacity %> people</p>
        </div>
      </div>
    </div>
  </div>

<!-- MAPBOX -->
<h2 class="text-center mt-5 pb-5 font-weight-bold">trip activities</h2>

<div class="container-card2">
  <% if policy(@trip).add_activity? %>
    <div id="new-activity-btn" style="text-align: center">
      <%= link_to "Add an activity", new_trip_activity_path(@trip), class: "btn btn-travel-primary"%>
    </div>
  <% end %>
  <div id="map2"
     style="width: 100%; height: 600px;"
     data-markers="<%= @markers.to_json %>"
     data-mapbox-api-key="<%= ENV['MAPBOX_API_KEY'] %>">
  </div>
</div>

<!-- TRIP ACTIVITIES -->
<div class="mt-5">
  <%= render 'shared/activity_cards', trip: @trip %>
</div>

<!-- TRIP USERS -->
  <h2 class="font-weight-bold text-center mt-5 mb-4">meet your dream team</h2>

  <div class="users-grid d-flex justify-content-around mt-5">
    <!-- TRIP OWNER -->
    <%#= render 'shared/usercards', user: @trip.user,booking: nil, current_user_booking: @booking%>



    <% @trip.bookings.each do |booking| %>
      <div class="card-and-review">
        <% if booking.status == "accepted" %>
          <%= render 'shared/usercards', user: booking.user, booking: booking, current_user_booking: @booking %>
        <% end %>
      </div>
    <% end %>
  </div>

  <!-- TRIP'S POST  -->

  <h2 class="font-weight-bold text-center mt-5 mb-4">trip posts</h2>
  <div class="posts bg-white rounded p-3 ">
    <% if @trip.posts.first == nil %>
      <p class='text-center'> No post available</p>
    <% else %>
      <%= render 'shared/post_cards_grid', posts: @trip.posts %>
    <% end %>
    <div class="text-center mt-3">
      <% if user_signed_in? && current_user.accepted_in?(@trip.id) %>
        <%= link_to 'Add a new post', new_trip_post_path(@trip), class: "btn btn-travel-secondary mb-3" %>
      <% end %>
    </div>
  </div>

<!-- TRIP'S STATUS AND CTAs -->

  <% if @trip.full? || @trip.departed? %>
    <div class='text-center mt-5'>
      <p> Trip is full or has already departed !</p>
    </div>
  <% else %>
    <% if user_signed_in? %>
      <% if @trip.user == current_user %>
        <div class="text-center mt-5 mb-3">
          <%= link_to 'Manage my trip', dashboard_path, class: 'btn-travel-primary' %>
        </div>
      <% elsif current_user.accepted_in?(@trip.id)%>
        <div class='text-center mt-5'>
          <p> You already joined this trip!</p>
        </div>
      <% elsif current_user.applied_for?(@trip.id) %>
        <div class="text-center mt-5">
          <p> You already applied to this trip!</p>
        </div>
      <% else %>
        <div class='text-center mt-5'>
          <button type="button" class="btn btn-travel-primary mb-3" data-toggle="modal" data-target="#joinModal">Join this trip</button>
        </div>
      <% end %>
    <% end %>
  <% end %>
  <div class='text-center my-5'>
    <%= link_to 'Back to all trips', trips_path, class: "btn btn-travel-secondary mb-3 " %>
  </div>

  <!-- MODAL JOIN A TRIP -->
  <div class="modal fade" id="joinModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Thank you for choosing this trip!</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <%= simple_form_for [ @trip, @new_booking ] do |f| %>
          <%= f.input :description, required: true, label: "Please tell us why you want to join this trip" %>
          <%= f.submit "Submit your application", class: "btn btn-travel-primary mt-3" %>
        <% end %>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-travel-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

</div>
